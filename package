set -e

export PATH=/cygdrive/y/src/github/vdisk-tools/vgui/bin/release:/cygdrive/z/src/github/vdisk-tools/vgui/bin/release:/Users/josh/src/github/vdisk-tools/bin:$PATH

echo Package started.
date

export DISKTYPE=FAT32
export DISKSIZE=33
export DEFINES="-D"$DISKTYPE" -DDEBUG"

echo creating disk image...
if [ ! -f hdd.img ]; then
	vmkimg -i hdd.img -M $DISKSIZE -b ./bin/bootsect -t $DISKTYPE>>/dev/zero
fi

echo copying files...
vput hdd.img ./bin/osldr /osldr
vmkdir hdd.img /system/bin
vput hdd.img ./bin/kernel /system/bin/kernel
vput hdd.img ./bin/shell /system/bin/shell
vput hdd.img ./bin/vesadrvr.o /system/bin/vesadrvr.o
vput hdd.img ./bin/splash /system/bin/splash
vput hdd.img ./bin/font /system/bin/font
vput hdd.img ./bin/cursor /system/bin/cursor

echo setting attributes...
vattr hdd.img /osldr rhs
vattr hdd.img /system/bin/kernel rs
vattr hdd.img /system/bin/shell rs
vattr hdd.img /system/bin/vesadrvr.o rs

echo Package Completed.
